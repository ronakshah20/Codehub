{% extends "base.html" %}
{% load static %}

{% block title %}CodeHub - {{ repo.owner.username }}/{{ repo.name }}{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'dashboard.css' %}"/>
{% endblock %}

{% block content %}
<div class="container">
    <main class="main-content">
        
        <div class="header-top">
            <h2 class="page-title">
                {{ repo.owner.first_name|default:repo.owner.username }} / <strong>{{ repo.name }}</strong>
            </h2>
            
            <div class="repo-actions">
                <a href="{% url 'create_file' repo.owner.username repo.name %}" class="btn-primary btn-action">
                    Create File
                </a>
		<a href="{% url 'upload_file' repo.owner.username repo.name %}" class="btn-primary btn-action btn-secondary">
		    Upload File
		</a>
		<a href="{% url 'repository_settings' repo.owner.username repo.name %}" class="btn-primary btn-action btn-secondary">
            	    Settings
        	</a>
        	<a href="{% url 'edit_repository' repo.owner.username repo.name %}" class="btn-primary btn-action btn-secondary">
		    Edit Repo
        	</a>
		<a href="{% url 'download_repository' repo.owner.username repo.name %}" class="btn-primary btn-action btn-secondary">Download as ZIP</a>
		<form action="{% url 'delete_repository' repo.owner.username repo.name %}" method="post" class="inline-form">
            	    {% csrf_token %}
            	    <button type="submit" class="btn-primary btn-action btn-danger" onclick="return confirm('Are you sure you want to delete this repository? This cannot be undone.')">
                	Delete Repo
            	    </button>
        	</form>
            </div>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <a href="{% url 'dashboard' %}" style="color: var(--primary); text-decoration: none;">
                &larr; Back to Dashboard
            </a>
        </div>

        <div class="repo-cards">
            <article class="repo-card">
                <div class="repo-info">
                    <h3 class="repo-title">Files</h3>
                </div>
                
                <div class="file-list" style="margin-top: 1rem;">
                    {% if files %}
                        <ul class="file-list-ul">
                            {% for file in files %}
                                <li class="file-list-item">
                                    <div class="file-name">
                                        <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle;">description</span>
                                        <span>{{ file.file_path }}</span>
                                    </div>
                                    
                                    <div class="file-actions">
                                        <a href="{% url 'edit_file' repo.owner.username repo.name file.id %}" class="btn-edit">
                                            Edit
                                        </a>
                                        
                                        <form action="{% url 'delete_file' repo.owner.username repo.name file.id %}" method="POST" class="delete-form">
                                            {% csrf_token %}
                                            <button type="submit" class="btn-delete" 
                                                    onclick="return confirm('Are you sure you want to delete \'{{ file.file_path }}\'? This cannot be undone.')">
                                                Delete
                                            </button>
                                        </form>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="repo-desc">This repository is empty.</p>
                    {% endif %}
                </div>
            </article>
        </div>

    </main>
</div>
{% endblock %}